---
title:
date: 2025-11-21
tags:
  - 自研游戏引擎
  - Cpp
category: 游戏引擎
description:
---
---



当前的 Transform 是极简实现：无父子层级，本质是 World 坐标系的 globalPosition、globalRotation、globalScale 组合而成的 Model 矩阵，未单独创建 Transform 类，仅通过矩阵直接作为 uniform 传给 Shader，实现多方块差异化渲染。

## 一、新增 / 修改核心代码

### 1. ExampleLayer 成员变量（新增）

```cpp
private:
    glm::vec3 m_SquarePosition = {0.0f}; // 阵列全局基准位置（World坐标）
    float m_SquareMoveSpeed = 1.0f;      // 帧率无关移动速度
```

### 2. Shader 修改（新增 Model 矩阵 uniform）

```glsl
// 蓝色Shader顶点着色器（关键修改）
std::string blueShaderVertexSrc = R"(
    #version 330 core
    layout(location = 0) in vec3 a_Position;
    uniform mat4 u_ViewProjection;
    uniform mat4 u_Transform; // World坐标系的Model矩阵（无父子关系）
    void main(){
        gl_Position = u_ViewProjection * u_Transform * vec4(a_Position, 1.0f);
    }
)";
```

### 3. OnUpdate 核心逻辑（新增控制 + 阵列渲染）

```cpp
void OnUpdate(Hazel::Timestep ts) override
{
    // 1. 阵列全局位置控制（WASD修改World坐标）
    if (Hazel::Input::IsKeyPressed(HZ_KEY_A)) m_SquarePosition.x -= m_SquareMoveSpeed * ts;
    if (Hazel::Input::IsKeyPressed(HZ_KEY_D)) m_SquarePosition.x += m_SquareMoveSpeed * ts;
    if (Hazel::Input::IsKeyPressed(HZ_KEY_W)) m_SquarePosition.y += m_SquareMoveSpeed * ts;
    if (Hazel::Input::IsKeyPressed(HZ_KEY_S)) m_SquarePosition.y -= m_SquareMoveSpeed * ts;

    // 2. 基础渲染流程
    Hazel::RenderCommand::SetClearColor({0.1f, 0.1f, 0.1f, 1});
    Hazel::RenderCommand::Clear();
    m_Camera.SetPosition(m_CameraPosition);
    Hazel::Renderer::BeginScene(m_Camera);

    // 3. 构建Model矩阵（globalPosition + 全局缩放 + 方块偏移）
    glm::mat4 globalTranslate = glm::translate(glm::mat4(1.0f), m_SquarePosition); // 全局平移
    glm::mat4 globalScale = glm::scale(glm::mat4(1.0f), glm::vec3(0.1f)); // 全局缩放

    // 5x5阵列：每个方块的World坐标由全局基准+偏移组成（无父子依赖）
    for(int i = 0; i < 5; i++)
        for(int j = 0; j < 5; j++)
        {
            glm::vec3 offset = glm::vec3(i * 0.11f, j * 0.11f, 0.0f); // 方块独立偏移（World坐标）
            glm::mat4 modelMatrix = globalTranslate * glm::translate(glm::mat4(1.0f), offset) * globalScale;
            Hazel::Renderer::Submit(m_BlueShader, m_SquareVA, modelMatrix); // 传入Model矩阵
        }

    Hazel::Renderer::EndScene();
}
```

## 二、核心说明

- **Transform 本质**：当前`modelMatrix`就是 World 坐标系的 Transform 载体，整合了全局平移（阵列位置）、全局缩放（方块大小）和独立偏移（单个方块位置），无任何父子层级关联，每个方块的位置直接基于 World 坐标计算；